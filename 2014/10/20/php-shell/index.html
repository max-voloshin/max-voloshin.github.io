<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP & Shell &mdash; Max Voloshin</title>
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/mv.jpg"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="Max Voloshin" />
    <meta name="title" content="PHP & Shell ">
    <link rel="canonical" href="http://maxvoloshin.com/2014/10/20/php-shell/">
     
           
    <meta property="og:title" content="PHP & Shell "/>
    <meta property="og:url" content="http://maxvoloshin.com/2014/10/20/php-shell/"/>
    
    
    <meta property="og:description" content="PHP developers deal with web development in most cases, where start point is a request to a web server. In spite of this we work with Shell. In order to do some tasks more effectively, worth looking the details of an intersection of PHP and Shell. "/>
    <meta name="description" content="PHP developers deal with web development in most cases, where start point is a request to a web server. In spite of this we work with Shell. In order to do some tasks more effectively, worth looking the details of an intersection of PHP and Shell. "/>
    
    <meta property="og:site_name" content="Max Voloshin">     
</head>
<body>
<div class="cover" style="background-image:url(/images/blog-cover.jpg)">
    <a href="/about/" class="btn btn-outline">About me</a>
    <a href="/" class="logo">
        <img src="/images/mv.jpg" alt="Max Voloshin">
    </a>
    <div class="social-bucket">
        <a class="social" href="https://twitter.com/maxvoloshindev" title="Follow on Twitter" target="_blank">
            <i class="icon icon-twitter"></i>
        </a>
        <a class="social" href="https://github.com/max-voloshin" title="Watch on Github" target="_blank">
            <i class="icon icon-github"></i>
        </a>
        <a class="social" href="http://facebook.com/MaxVoloshin" title="Like on Facebook" target="_blank">
            <i class="icon icon-facebook"></i>
        </a>
        <a class="social" href="https://www.linkedin.com/pub/max-voloshin/95/aba/507" title="Connect on LinkedIn" target="_blank">
            <i class="icon icon-linkedin"></i>
        </a>
        <a class="social" href="/feed.xml" title="RSS Feed">
            <i class="icon icon-rss"></i>
        </a>
    </div>
</div>
<article>

    <div class="container">
        <header>
            <div class="meta">
                <!--By <address><a rel="author" href="" title="" target="_blank"></a></address> &mdash;-->
                <time pubdate datetime="2014-20-October" title="October 20, 2014">October 20, 2014</time>
            </div>
            <h1 class="title">PHP & Shell</h1>
            <h2 class="subtitle">How it works together</h2>
        </header>

        <section>
            <h2 id="why_php_developers_should_know_about_shell">Why PHP developers should know about Shell?</h2>

<p>PHP developers deal with web development in most cases, where start point is a request to a web server. In spite of this we work with Shell:</p>

<ul>
<li>we use a terminal emulator: iTerm / Gnome Terminal / Konsole / xterm / etc</li>

<li>we log to a remote machine via SSH</li>

<li>we use such PHP function as <code>exec</code> / <code>shell_exec</code> / <code>system</code> / <code>passthru</code> / <code>proc_open</code> or the backtick operator <code>`...`</code></li>

<li>we create a command line interface to the own application for ability to automate routine actions</li>
</ul>

<p>In order to do these tasks more effectively, worth looking the details of an intersection of PHP and Shell.</p>

<h2 id="what_is_shell">What is Shell?</h2>

<p>Shell – an interpreter of the command line language which is determined by POSIX standard. There are couple of implementations:</p>

<ul>
<li>Original Bourne Shell – <strong>sh</strong> – used in most UNIX systems</li>

<li>Bourne Again Shell – <strong>bash</strong> – used in most Linux systems</li>

<li>Debian Almquist Shell – <strong>dash</strong> – used in Debian</li>

<li>Z Shell – <strong>zsh</strong> – used by advanced users of command line :)</li>

<li>etc</li>
</ul>

<h2 id="running_a_php_application_from_shell">Running a PHP application from Shell</h2>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span> <span class='c1'>//sapi.php</span>
<span class='k'>echo</span> <span class='nx'>PHP_SAPI</span> <span class='o'>.</span> <span class='nx'>PHP_EOL</span> <span class='o'>.</span> <span class='nb'>php_sapi_name</span><span class='p'>()</span> <span class='o'>.</span> <span class='nx'>PHP_EOL</span><span class='p'>;</span>
</code></pre></div><div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>php sapi.php
cli
cli
</code></pre></div>
<p>Thus we can determine running via Shell with the constant <code>PHP_SAPI</code> or the function <code>php_sapi_name</code>.</p>

<h2 id="shell_variables_and_environment_variables">Shell variables and environment variables</h2>

<p>We can use variables in Shell:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ FOO</span><span class='o'>=</span>value
<span class='nv'>$ </span><span class='nb'>echo</span> <span class='nv'>$FOO</span>
value
<span class='nv'>$ BAR</span><span class='o'>=</span><span class='s1'>&#39;another value&#39;</span>
<span class='nv'>$ </span><span class='nb'>echo</span> <span class='s2'>&quot;$FOO and $BAR&quot;</span>
value and another value
</code></pre></div>
<p>There is a special set of Shell variables: environment variables. Current environment variables are able to be shown with the tool <code>env</code>:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>env
<span class='nv'>PATH</span><span class='o'>=</span>/usr/local/bin:/usr/bin:/bin
<span class='nv'>HOME</span><span class='o'>=</span>/Users/maxvoloshin
<span class='nv'>USER</span><span class='o'>=</span>maxvoloshin
<span class='nv'>SHELL</span><span class='o'>=</span>/bin/zsh
<span class='nv'>PWD</span><span class='o'>=</span>/Users/maxvoloshin
<span class='nv'>_</span><span class='o'>=</span>/usr/bin/env
</code></pre></div>
<p>If we want to transform a variable to an environment variable we should use the command <code>export</code>:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ FOO</span><span class='o'>=</span>value
<span class='nv'>$ </span><span class='nb'>export </span>FOO
<span class='nv'>$ </span>env
...
<span class='nv'>FOO</span><span class='o'>=</span>value
</code></pre></div>
<p>With each Shell execution of commands the new Shell process is created, which copy environment variables of the parent process. Exclusively for a new process it is possible to pass a special value of an environment variable or even to pass a new variable.</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ FOO</span><span class='o'>=</span>value
<span class='nv'>$ FOO</span><span class='o'>=</span>new <span class='nv'>BAZ</span><span class='o'>=</span>value env
...
<span class='nv'>FOO</span><span class='o'>=</span>new
<span class='nv'>BAZ</span><span class='o'>=</span>value
<span class='nv'>$ </span><span class='nb'>echo</span> <span class='nv'>$FOO</span>
value
<span class='nv'>$ </span><span class='nb'>echo</span> <span class='nv'>$BAZ</span>
<span class='nv'>$ </span>
</code></pre></div>
<p>Take into account that in the current context the value of variable <code>FOO</code> is not changed and variable <code>BAZ</code> is not created (command <code>echo $BAZ</code> shows nothing).</p>

<h2 id="passing_parameters_from_shell_to_a_php_application">Passing parameters from Shell to a PHP application</h2>

<h3 id="usage_of_environment_variables">Usage of environment variables</h3>

<p>Values of environment variables are available in a PHP application via the function <code>getenv</code>:</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span> <span class='c1'>//getenv.php</span>
<span class='k'>echo</span> <span class='nb'>getenv</span><span class='p'>(</span><span class='s1'>&#39;FOO&#39;</span><span class='p'>)</span> <span class='o'>.</span> <span class='nx'>PHP_EOL</span><span class='p'>;</span>
</code></pre></div>
<p>Look in Shell:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ FOO</span><span class='o'>=</span>value php getenv.php
value
</code></pre></div>
<p>Depending on the PHP configuration <code>request_order</code> and <code>variables_order</code>, environment variables are available in superglobal variables <code>$_SERVER</code>, <code>$_REQUEST</code> and <code>$_ENV</code>.</p>

<h3 id="usage_of_command_arguments">Usage of command arguments</h3>

<p>Receiving information about command arguments is possible via <code>$_SERVER[&#39;argc&#39;]</code> and <code>$_SERVER[&#39;argv&#39;]</code>:</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span> <span class='c1'>//argc_argv.php</span>
<span class='nb'>print_r</span><span class='p'>(</span><span class='nv'>$_SERVER</span><span class='p'>[</span><span class='s1'>&#39;argc&#39;</span><span class='p'>]);</span>
<span class='k'>echo</span> <span class='nx'>PHP_EOL</span><span class='p'>;</span>
<span class='nb'>print_r</span><span class='p'>(</span><span class='nv'>$_SERVER</span><span class='p'>[</span><span class='s1'>&#39;argv&#39;</span><span class='p'>]);</span>
</code></pre></div>
<p>Usage:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>php argc_argv.php some -arguments --here
4
Array
<span class='o'>(</span>
    <span class='o'>[</span>0<span class='o'>]</span> <span class='o'>=</span>&gt; argc_argv.php
    <span class='o'>[</span>1<span class='o'>]</span> <span class='o'>=</span>&gt; some
    <span class='o'>[</span>2<span class='o'>]</span> <span class='o'>=</span>&gt; -arguments
    <span class='o'>[</span>3<span class='o'>]</span> <span class='o'>=</span>&gt; --here
<span class='o'>)</span>
</code></pre></div>
<p>Depending on the PHP configuration <code>register_argc_argv</code>, this information are available in superglobal variables <code>$argc</code> and <code>$argv</code>.</p>

<p>Alternative approach is usage of the function <code>getopt</code>:</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span> <span class='c1'>//getopt.php</span>
<span class='nb'>var_dump</span><span class='p'>(</span><span class='nb'>getopt</span><span class='p'>(</span><span class='s1'>&#39;ab:c::&#39;</span><span class='p'>,</span> <span class='k'>array</span><span class='p'>(</span><span class='s1'>&#39;foo&#39;</span><span class='p'>,</span> <span class='s1'>&#39;bar:&#39;</span><span class='p'>,</span> <span class='s1'>&#39;baz::&#39;</span><span class='p'>)));</span>
</code></pre></div>
<p>Usage:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>php getopt.php -a -b<span class='o'>=</span>value -c -c<span class='o'>=</span>value --foo --bar<span class='o'>=</span>value1 --bar<span class='o'>=</span>value2 --baz
array<span class='o'>(</span>6<span class='o'>)</span> <span class='o'>{</span>
  <span class='o'>[</span><span class='s2'>&quot;a&quot;</span><span class='o'>]=</span>&gt;
  bool<span class='o'>(</span><span class='nb'>false</span><span class='o'>)</span>
  <span class='o'>[</span><span class='s2'>&quot;b&quot;</span><span class='o'>]=</span>&gt;
  string<span class='o'>(</span>5<span class='o'>)</span> <span class='s2'>&quot;value&quot;</span>
  <span class='o'>[</span><span class='s2'>&quot;c&quot;</span><span class='o'>]=</span>&gt;
  array<span class='o'>(</span>2<span class='o'>)</span> <span class='o'>{</span>
    <span class='o'>[</span>0<span class='o'>]=</span>&gt;
    bool<span class='o'>(</span><span class='nb'>false</span><span class='o'>)</span>
    <span class='o'>[</span>1<span class='o'>]=</span>&gt;
    string<span class='o'>(</span>5<span class='o'>)</span> <span class='s2'>&quot;value&quot;</span>
  <span class='o'>}</span>
  <span class='o'>[</span><span class='s2'>&quot;foo&quot;</span><span class='o'>]=</span>&gt;
  bool<span class='o'>(</span><span class='nb'>false</span><span class='o'>)</span>
  <span class='o'>[</span><span class='s2'>&quot;bar&quot;</span><span class='o'>]=</span>&gt;
  array<span class='o'>(</span>2<span class='o'>)</span> <span class='o'>{</span>
    <span class='o'>[</span>0<span class='o'>]=</span>&gt;
    string<span class='o'>(</span>6<span class='o'>)</span> <span class='s2'>&quot;value1&quot;</span>
    <span class='o'>[</span>1<span class='o'>]=</span>&gt;
    string<span class='o'>(</span>6<span class='o'>)</span> <span class='s2'>&quot;value2&quot;</span>
  <span class='o'>}</span>
  <span class='o'>[</span><span class='s2'>&quot;baz&quot;</span><span class='o'>]=</span>&gt;
  bool<span class='o'>(</span><span class='nb'>false</span><span class='o'>)</span>
<span class='o'>}</span>
</code></pre></div>
<h2 id="running_a_php_application_in_posix_style">Running a PHP application in POSIX style</h2>

<p>Running a PHP applications as <code>php app.php</code>, of course, is a working approach, but it can be done in a native style for the POSIX systems, similar to how we use utilities <code>cat</code>, <code>ls</code>, <code>cp</code>, etc.</p>

<p>Let’s create the file <code>argv</code>:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>touch argv
</code></pre></div>
<p>For the execution of such a program by the user, the file must have the appropriate owners and permissions. The tool <code>ls</code> helps to receive that information:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>ls -l argv
-rw-r--r--  maxvoloshin  staff  ...
</code></pre></div>
<p>Look at parts of the output (from left to right):</p>

<ul>
<li><code>-</code> – regular file</li>

<li><code>rw-</code> – owner has permissions to read and write file</li>

<li><code>r--</code> – users of group have permissions to read file</li>

<li><code>r--</code> – all users have permissions to read file</li>

<li><code>maxvoloshin</code> – owner of file</li>

<li><code>staff</code> – group of file</li>
</ul>

<p>For an execution this file by the user <code>maxvoloshin</code> must do one of the following conditions:</p>

<ul>
<li>the user <code>maxvoloshin</code> is owner of a file and an execution by owner is allowed</li>

<li>the user <code>maxvoloshin</code> is included in the group <code>staff</code> and an execution by a group is allowed</li>

<li>an execution by any user is allowed</li>
</ul>

<p>Permissions can be set by the tool <code>chmod</code>. For example, to allow an execution of a file by owner:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>chmod u+x argv
<span class='nv'>$ </span>ls -l argv
-rwxr--r-- ...
</code></pre></div>
<p>The fourth character (<code>x</code>) describes the permissions to execute the file by owner.</p>

<p>The file must contain “shebang line” with PHP call, then the file will be executed via PHP. “Shebang line” – the first line of the file that starts with <code>#!</code> and contains call of program for execution of the file.</p>

<p>On different systems PHP interpreter can be located on different paths, so it is commonly used the tool <code>env</code> for calling program by the name. The tool <code>env</code> resolves the path to the program by environment variables.</p>
<div class='highlight'><pre><code class='php'><span class='x'>#!/usr/bin/env php</span>
<span class='cp'>&lt;?php</span> <span class='c1'>//argv</span>
<span class='nb'>print_r</span><span class='p'>(</span><span class='nv'>$_SERVER</span><span class='p'>[</span><span class='s1'>&#39;argv&#39;</span><span class='p'>]);</span>
</code></pre></div>
<p>The easiest way to execute the file in Shell – call it by an absolute or a relative path:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>/Users/maxvoloshin/argv
Array
<span class='o'>(</span>
    <span class='o'>[</span>0<span class='o'>]</span> <span class='o'>=</span>&gt; /Users/maxvoloshin/argv
<span class='o'>)</span>

<span class='nv'>$ </span>./argv
Array
<span class='o'>(</span>
    <span class='o'>[</span>0<span class='o'>]</span> <span class='o'>=</span>&gt; ./argv
<span class='o'>)</span>
</code></pre></div>
<p>In most cases such way is not convenient for working with global tools, because it is necessary to keep in mind a path of an each tool. This task is solved by the environment variable <code>PATH</code>.</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span><span class='nb'>echo</span> <span class='nv'>$PATH</span>
/usr/local/bin:/usr/bin:/bin
</code></pre></div>
<p>Value of this variable contains paths to directories with tools (<code>:</code> is used as a separator). Let’s add the current directory to the environment variable <code>PATH</code>:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ PATH</span><span class='o'>=</span><span class='nv'>$PATH</span>:<span class='sb'>`</span><span class='nb'>pwd</span><span class='sb'>`</span>
<span class='nv'>$ </span><span class='nb'>echo</span> <span class='nv'>$PATH</span>
/usr/local/bin:/usr/bin:/bin:/Users/maxvoloshin
</code></pre></div>
<p>The tool <code>which</code> shows the absolute path to the tool by name:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>which argv
/Users/maxvoloshin/argv
</code></pre></div>
<p>Thus we can execute an application by name:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>argv
Array
<span class='o'>(</span>
    <span class='o'>[</span>0<span class='o'>]</span> <span class='o'>=</span>&gt; /Users/maxvoloshin/argv
<span class='o'>)</span>
</code></pre></div>
<h2 id="streams_input_output_and_errors">Streams: input, output and errors</h2>

<p>An each program in Shell can receive data from <code>STDIN</code> (input stream) and send data to <code>STDOUT</code> (output stream) and <code>STDERR</code> (errors stream):</p>
<div class='full'><img src='/images/shell-streams.png' /></div>
<p>For working with those streams in PHP (CLI mode) we should use special constants:</p>
<div class='highlight'><pre><code class='php'><span class='x'>STDIN  = fopen(&#39;php://stdin&#39;, &#39;r&#39;)</span>
<span class='x'>STDOUT = fopen(&#39;php://stdout&#39;, &#39;w&#39;)</span>
<span class='x'>STDERR = fopen(&#39;php://stderr&#39;, &#39;w&#39;)</span>
</code></pre></div>
<h3 id="usage_of_the_output_stream">Usage of the output stream</h3>
<div class='highlight'><pre><code class='php'><span class='x'>#!/usr/bin/env php</span>
<span class='cp'>&lt;?php</span> <span class='c1'>//stdout</span>
<span class='nb'>fwrite</span><span class='p'>(</span><span class='nx'>STDOUT</span><span class='p'>,</span> <span class='s2'>&quot;Content</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>);</span> <span class='c1'>//echo &quot;Content\n&quot;</span>
</code></pre></div>
<p>Usage:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout
Content
</code></pre></div>
<p>Additionally we can redirect the output to the file:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout &gt; file
<span class='nv'>$ </span>cat file
Content
</code></pre></div>
<p>Also we can append the output to the existing file:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout &gt; file
<span class='nv'>$ </span>stdout &gt;&gt; file
<span class='nv'>$ </span>cat file
Content
Content
</code></pre></div>
<p><strong>ProTip</strong>: <em>Do not implement those features in your application because its are implemented in Shell already.</em></p>

<h3 id="usage_of_the_errors_stream">Usage of the errors stream</h3>

<p>Taking into account that the output can be redirected, good practice is to split the output and errors. For example, we want notify user in case uncaught exception:</p>
<div class='highlight'><pre><code class='php'><span class='x'>#!/usr/bin/env php</span>
<span class='cp'>&lt;?php</span> <span class='c1'>//stdout_stderr</span>
<span class='nb'>fwrite</span><span class='p'>(</span><span class='nx'>STDOUT</span><span class='p'>,</span> <span class='s2'>&quot;Content</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>);</span>
<span class='nb'>set_exception_handler</span><span class='p'>(</span><span class='k'>function</span><span class='p'>(</span><span class='nx'>Exception</span> <span class='nv'>$e</span><span class='p'>)</span> <span class='p'>{</span>
   <span class='nb'>fwrite</span><span class='p'>(</span><span class='nx'>STDERR</span><span class='p'>,</span> <span class='nv'>$e</span><span class='o'>-&gt;</span><span class='na'>getMessage</span><span class='p'>());</span>
<span class='p'>});</span>
<span class='k'>throw</span> <span class='k'>new</span> <span class='nx'>Exception</span><span class='p'>(</span><span class='s1'>&#39;Error!&#39;</span><span class='p'>);</span>
</code></pre></div>
<p>Usage:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout_stderr
Content
Error!
</code></pre></div>
<p>Looks like a simple output, but we can feel the difference if we use redirection:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout_stderr &gt; file
Error!
<span class='nv'>$ </span>cat file
Content
</code></pre></div>
<p>We can redirect errors to the file:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout_stderr 2&gt; file
Content
<span class='nv'>$ </span>cat file
Error!
</code></pre></div>
<p>We can redirect union of the output and errors to the file:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout_stderr &gt; file 2&gt;<span class='p'>&amp;</span>1
<span class='nv'>$ </span>cat file
Content
Error!
</code></pre></div>
<p>We can redirect the output and errors separately:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout_stderr &gt; content 2&gt; error
<span class='nv'>$ </span>cat content
Content
<span class='nv'>$ </span>cat error
Error!
</code></pre></div>
<h3 id="usage_of_the_input_stream">Usage of the input stream</h3>

<p>One of the approaches to pass a data to an application is usage of the input stream:</p>
<div class='highlight'><pre><code class='php'><span class='x'>#!/usr/bin/env php</span>
<span class='cp'>&lt;?php</span> <span class='c1'>//stdin</span>
<span class='nb'>var_dump</span><span class='p'>(</span><span class='nx'>trim</span><span class='p'>(</span><span class='nb'>stream_get_contents</span><span class='p'>(</span><span class='nx'>STDIN</span><span class='p'>)));</span>
</code></pre></div>
<p>Usage:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdin
Hello from Shell
&lt;Ctrl+D&gt;
string<span class='o'>(</span>16<span class='o'>)</span> <span class='s2'>&quot;Hello from Shell&quot;</span>
</code></pre></div>
<p>After starting <code>stdin</code>, Shell waits an input of contents. When the input is finished, the combination <code>Ctrl + D</code> must be pressed.</p>

<p>There is ability to redirect a content of a file to the input stream:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout &gt; file
<span class='nv'>$ </span>cat file
Content
<span class='nv'>$ </span>stdin &lt; file
string<span class='o'>(</span>7<span class='o'>)</span> <span class='s2'>&quot;Content&quot;</span>
</code></pre></div>
<p>or an arbitrary text:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdin <span class='o'>&lt;&lt;&lt;</span> <span class='s2'>&quot;some string&quot;</span>
string<span class='o'>(</span>11<span class='o'>)</span> <span class='s2'>&quot;some string&quot;</span>
</code></pre></div>
<p>It is important to realize that <code>stream_get_contents(STDIN)</code> is a blocking call. If you want the application to run, regardless of the availability of data in the input stream, you can use the following approach:</p>
<div class='highlight'><pre><code class='php'><span class='x'>#!/usr/bin/env php</span>
<span class='cp'>&lt;?php</span> <span class='c1'>//non_blocking_stdin</span>
<span class='nv'>$read</span> <span class='o'>=</span> <span class='p'>[</span><span class='nx'>STDIN</span><span class='p'>];</span>
<span class='nv'>$write</span> <span class='o'>=</span> <span class='k'>null</span><span class='p'>;</span>
<span class='nv'>$except</span> <span class='o'>=</span> <span class='k'>null</span><span class='p'>;</span>
<span class='k'>if</span> <span class='p'>(</span><span class='nb'>stream_select</span><span class='p'>(</span><span class='nv'>$read</span><span class='p'>,</span> <span class='nv'>$write</span><span class='p'>,</span> <span class='nv'>$except</span><span class='p'>,</span> <span class='mi'>0</span><span class='p'>)</span> <span class='o'>===</span> <span class='mi'>1</span><span class='p'>)</span> <span class='p'>{</span>
   <span class='nb'>var_dump</span><span class='p'>(</span><span class='nx'>trim</span><span class='p'>(</span><span class='nb'>stream_get_contents</span><span class='p'>(</span><span class='nx'>STDIN</span><span class='p'>)));</span>
<span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
   <span class='k'>echo</span> <span class='s2'>&quot;Data is not available in STDIN</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre></div>
<p>Usage:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>non_blocking_stdin
Data is not available in STDIN
<span class='nv'>$ </span>non_blocking_stdin <span class='o'>&lt;&lt;&lt;</span> <span class='s2'>&quot;Hello&quot;</span>
string<span class='o'>(</span>5<span class='o'>)</span> <span class='s2'>&quot;Hello&quot;</span>
</code></pre></div>
<h2 id="composition_of_shell_programs">Composition of Shell programs</h2>

<p>One of the beautiful opportunities of Shell is composition of programs. It helps to follow the principle “one program – one task” and build solutions of multiple problems with several tools at the same time.</p>

<h3 id="sequential_execution">Sequential execution</h3>

<p>Simplest approach of program’s composition is sequential execution:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout<span class='p'>;</span> stdout
Content
Content
</code></pre></div>
<p>It is execution of programs one after one.</p>

<h3 id="determining_the_success_of_the_program">Determining the success of the program</h3>

<p>It is often necessary that the program in the chain depended on the success of the previous program. The success of the execution of the program is determined by the return code: 0 - successful, otherwise - error.</p>

<p>Return code of PHP applications is argument of the function <code>exit</code>. In Shell, the return code of the previous command is determined by using <code>$?</code>.</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span> <span class='c1'>//ok.php</span>
<span class='nb'>fwrite</span><span class='p'>(</span><span class='nx'>STDOUT</span><span class='p'>,</span> <span class='s2'>&quot;OK</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>);</span>
<span class='k'>exit</span><span class='p'>(</span><span class='mi'>0</span><span class='p'>);</span>
</code></pre></div><div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span> <span class='c1'>//fail.php</span>
<span class='nb'>fwrite</span><span class='p'>(</span><span class='nx'>STDERR</span><span class='p'>,</span> <span class='s2'>&quot;FAIL</span><span class='se'>\n</span><span class='s2'>&quot;</span><span class='p'>);</span>
<span class='k'>exit</span><span class='p'>(</span><span class='mi'>1</span><span class='p'>);</span>
</code></pre></div>
<p>Usage:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>php ok.php
OK
<span class='nv'>$ </span><span class='nb'>echo</span> <span class='nv'>$?</span>
0
<span class='nv'>$ </span>php fail.php
FAIL
<span class='nv'>$ </span><span class='nb'>echo</span> <span class='nv'>$?</span>
1
</code></pre></div>
<h3 id="conditional_execution">Conditional execution</h3>

<p>Program execution in case of the success of previous is possible through operator <code>&amp;&amp;</code>:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>php fail.php <span class='o'>&amp;&amp;</span> php ok.php
FAIL
<span class='nv'>$ </span><span class='nb'>echo</span> <span class='nv'>$?</span>
1
</code></pre></div>
<p>Program execution in case of the failure of previous is possible through operator <code>||</code>:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>php ok.php <span class='o'>||</span> php fail.php
OK
<span class='nv'>$ </span><span class='nb'>echo</span> <span class='nv'>$?</span>
0
</code></pre></div>
<h3 id="pipeline_execution">Pipeline execution</h3>

<p>The most powerful (IMO) ability of composition of programs in Shell is pipeline execution. The essence of the pipeline that the data of the output stream of one program is sent to the input stream of another program. It is possible through operator <code>|</code>:</p>
<div class='highlight'><pre><code class='sh'><span class='nv'>$ </span>stdout <span class='p'>|</span> stdin <span class='p'>|</span> stdin <span class='p'>|</span> stdin
string<span class='o'>(</span>32<span class='o'>)</span> <span class='s2'>&quot;string(19) &quot;</span>string<span class='o'>(</span>7<span class='o'>)</span> <span class='s2'>&quot;Content&quot;&quot;&quot;</span>
</code></pre></div>
<h2 id="conclusion">Conclusion</h2>

<p>I hope that this post gives to you an initial idea how to work with PHP in Shell. If some aspect of this post is not clear enough, feel free to ask about it in comments.</p>
            <div class="social">
    <div>
        <a href="https://twitter.com/share" class="twitter-share-button"  data-text="PHP & Shell" data-related="maxvoloshindev">Tweet</a>
    </div>
    <div>
        <div class="fb-like" data-width="150" data-layout="button_count" data-action="like" data-show-faces="true" data-send="false"></div>
    </div>
</div>
        </section>

        <!--<footer>
            <address>
               
                <p>Written by <strong><a rel="author" href="https://twitter.com/" title="" target="_blank"></a></strong><br>
                <span class="muted"></span>
                </p>
            </address>

        </footer>-->

        
        <section>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'maxvoloshin'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
        </section>
        
    </div>
</article>

<div class="site-footer">
    <div class="container">
    Blog theme inspiration: <a href="https://github.com/kippt/jekyll-incorporated/">Jekyll Incorporated</a>
    <br>
    Cover photo: Dnipropetrovsk, Ukraine. Photographer: Avilov Alexandr
    </div>
</div>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=253595308025739";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-55921457-1', 'auto');
    ga('send', 'pageview');
</script>


</body>
</html>
